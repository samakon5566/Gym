@model IEnumerable<prjGymEndTerm.ViewModels.OrderCourseViewModel>

@{
    ViewData["Title"] = "課程管理";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/assets/vendor/bootstrap/css/bootstrap.min.css">

<style>
    .chaticon a{
        color:#FFF;
    }

     .container a{
            color: #FFF;
        }
        .container a:visited {
            color: #FFF;
        }
        .container  a:hover {
            color: #FFF;
            text-decoration: underline;
        }
        .container  span {
            color: #FFA500;
        }
        .Coach-panel-19 {
            color: #FFF;
            background-color: #272727;
            border-radius: 15px;
            padding: 20px 20px 20px 20px;
            margin-top: 0px;
        }
        .Coach-panel-row-19 {
            margin-top: 10px;
            color: #FFF;
        }
        .Coach-panel-19 .Coach-panel-row-19 a:hover {
            color: #F36100;
            cursor: grab;
            text-decoration: underline;
        }
        .Coach-panel-19 .Coach-panel-row-19 > input {
            font-size: 14px;
            color: #c4c4c4;
            width: 90%;
            height: 50px;
            padding-left: 20px;
            padding-right: 5px;
            background: black;
            margin-bottom: 20px;
            border: 1px solid #8E8E8E;
        }
            .Coach-panel-19  button {
                font-size: 14px;
                color: #ffffff;
                text-transform: uppercase;
                font-weight: 700;
                width: 20%;
                border: none;
                padding: 14px 0 12px;
            }
        .coach-image-19{
            margin-top:5%;
        }
        .coach-image-19 > img {
            border-radius: 50%;
            height: 150px;
            width: 150px;
        }

        input[type="date"] {
            position: relative;
            padding: 10px;
        }

            input[type="date"]::-webkit-calendar-picker-indicator {
                color: transparent;
                background: none;
                z-index: 1;
            }

            input[type="date"]:before {
                color: transparent;
                background: none;
                display: block;
                font-family: 'FontAwesome';
                content: '\f073';
                /* This is the calendar icon in FontAwesome */
                width: 15px;
                height: 20px;
                position: absolute;
                top: 12px;
                right: 6px;
                color: #999;
            }

    body {
        background-color: #151515
    }
    ﻿.starbox {
        width: 90%;
        margin: auto;
        padding: 20px;
    }                          
    .star{
        width: 20%;
        filter: grayscale(1);
        float: left;
        transition:.5s;
    }
    .starC {
        width: 20%;
        filter: grayscale(0);
        float: left;
        transition: .5s;
    }
    .score {
        text-align: center;
        font-family: 'Noto Sans TC', sans-serif;
        font-size: 40px;
        letter-spacing: 10px;
        clear: both;
    }
    .calendat-19 {
        position: relative;
        padding-top: 30px;
        padding-right: 30px;
        padding-left: 30px;
        padding-bottom: 20px;
        background-color: rgb(255,255,255);
        width: 1200px;
        height: 600px;
        border-bottom-right-radius: 30px;
        border-bottom-left-radius: 30px;
    }
    .calendatHeader-19 {
        width: 1200px;
        height: 50px;
        border-top-left-radius: 30px;
        border-top-right-radius: 30px;
        background-color: #FFA500;
    }
</style>

<section class="contact-section spad-3 ">
    <div style="width: 1200px; padding-left: 0px; margin: auto; position: relative; font-size: 18px" class="container">
        <div>
            <a asp-controller="PersonalArea" asp-action="List">
                會員首頁
            </a>
            <label style="color:#FFF">
                >
            </label>
            <span >
                目前頁面
            </span>
        </div>
        <div class="leave-comment">
            <label style="font-size: 28px; color: orange"></label>
        </div>
        <div class="tab-regular">
            <ul style="font-size: 18px; color: black" class="nav nav-tabs " id="myTab" role="tablist">
                <li class="nav-item">
                    <a style="color: #ffa500; font-weight:900" class="nav-link active show" id="歷史訂單-tab" data-toggle="tab" href="#歷史訂單" role="tab" aria-controls="歷史訂單" aria-selected="true">訂單紀錄</a>
                </li>
                <li class="nav-item">
                    <a style="color: #ffa500; font-weight: 900" class="nav-link" id="課程表-tab" data-toggle="tab" href="#課程表" role="tab" aria-controls="課程表" aria-selected="false">課程表</a>
                </li>
            </ul>
        </div>
    </div>
    <div>
        <div class="tab-content" id="myTabContent" style="margin-top: 5px; margin: auto; position: relative; width: 1200px">
            <div class="tab-pane fade active show" id="歷史訂單" role="tabpanel" aria-labelledby="歷史訂單-tab">
                <div>
                    <br />
                    <table style="text-align: center; width: 1200px;margin-left:30px; " class="table table-striped table-dark ">
                        <thead>
                            <tr>
                                <th style="display:none">
                                    @Html.DisplayNameFor(model => model.CourseClass_Id)
                                </th>
                                <th style="color:white">
                                    @Html.DisplayNameFor(model => model.OrderTime)
                                </th>
                                <th style="color:white">
                                    @Html.DisplayNameFor(model => model.CourseClass_Name)
                                </th>
                                <th style="color:white">
                                    @Html.DisplayNameFor(model => model.Payment_Name)
                                </th>
                                <th style="color:white">
                                    @Html.DisplayNameFor(model => model.status_Content)
                                </th>
                                <th style="color:white">
                                    @Html.DisplayNameFor(model => model.OrderReviseTime)
                                </th>
                                <th style="color:white">
                                    @Html.DisplayNameFor(model => model.Reason_Content)
                                </th>
                                <th style="color:white">
                                    @Html.DisplayNameFor(model => model.OrderReasonMoney)
                                </th>
                                <th style="color:white">
                                    評分
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int count = 0;
                                foreach (var item in Model)
                                {
                                    count++;
                                    <tr>
                                        <td style="display:none">
                                            @Html.DisplayFor(modelItem => item.CourseClass_Id)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.OrderTime)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.CourseClass_Name)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Payment_Name)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.status_Content)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.OrderReviseTime)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Reason_Content)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.OrderReasonMoney)
                                        </td>
                                        <td id="CourseScore">
                                            <a data-toggle="modal" @*href="#score"*@ class="f-w-400" style="color: #FFA500;cursor: grab;" data-target="#score_@count">課程評分</a>
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-pane fade" id="課程表" role="tabpanel" aria-labelledby="課程表-tab" style=" margin-top: 10px; margin: auto; position: relative; width: 1200px ">
                <section class="contact-section spad-2" style=" padding-top: 20px;margin-left:30px;">                                        
                    <div class="row">
                        <div class="col-12">
                            <div class="calendatHeader-19">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="calendat-19">
                                <div id='calendar'>
                                </div>
                            </div>
                        </div>
                    </div>                    
                </section>
            </div>
        </div>
    </div>
    @for (var i = 0; i <= count; i++)
    {
        <div style="height: 100%; width: 800px; margin: auto; " class="modal fade" id="score_@i" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content" style="margin: auto; position: relative;">
                    <div class="modal-header">
                        <h5 class="modal-title">評分</h5>
                        <a class="close" data-dismiss="modal"><i class="fas fa-times"></i></a>
                    </div>
                    <div style="margin-top: 20px; padding-left: 20px; font-size: 20px">
                        <div class="starbox">
                            <img class="star" src="~/img/star.png" />
                            <img class="star" src="~/img/star.png" />
                            <img class="star" src="~/img/star.png" />
                            <img class="star" src="~/img/star.png" />
                            <img class="star" src="~/img/star.png" />
                        </div>
                        <div><p style="font-size: 16px;" class="score">點擊填寫評價</p> </div>
                    </div>
                    <div style="margin-top:20px;">
                        <div class="container">
                            <label style="font-size:20px">寫下您的評論：</label>
                        </div>
                        <div style="padding-left: 10px;padding-right: 10px;" class="input-group">
                            <textarea name="content"  class="form-control content" aria-label="With textarea"></textarea>
                        </div>
                    </div>
                    <div style="margin-top: 20px">
                        <input style="width: 100px; margin: auto; position: relative" type="submit" value="送出" class="btn btn-block btn-primary mb-4 ScoreAfterClass">
                    </div>
                    <div style=" margin: auto; position: relative">
                        <input type="button" class="Demo" style="margin-bottom: 20px; background-color: #007BFF; color: white; width: 100px;height:38px; border-radius: 5px; border-color: #007BFF " value="Demo">
                    </div>
                </div>
            </div>
        </div>
    }
</section>

<form name="Score" id="ScoreForm">
    <input type="hidden" name="CourseClassID" />
    <input type="hidden" name="Classcomment" />
    <input type="hidden" name="ClassScore" />   
</form>

@section Scripts{
    <script src="~/js/CoachCourse/main.js"></script>
    <link href="~/js/CoachCourse/main.css" rel="stylesheet" />
    <script src="~/js/CoachCourse/locales-all.js"></script>
    <script>        
        let starNum = 0;
        $("div.starbox img").on({
            mouseenter: function (event) {

                $(this).prop("class", "starC").prevAll().prop("class", "starC");
                starNum = $(this).index();
                $("p.score").text("評價中..." + (starNum + 1) + "顆星");
            },
            mouseleave: function (event) {
                $(this).prop("class", "star").prevAll().prop("class", "star");
                $("p.score").text("點擊填寫評價");
            },
            click: function () {
                $("p.score").text("評價完成:" + (starNum + 1) + "顆星，雙擊2下重新評價");
                $(this).off("mouseenter mouseleave click").siblings().off("mouseenter mouseleave click");
            },
            dblclick: function () {
                $(this).prop("class", "star").siblings().prop("class", "star");
                $("p.score").text("點擊填寫評價");
                $("div.starbox img").on({
                    mouseenter: function (event) {
                        $(this).prop("class", "starC").prevAll().prop("class", "starC");
                        starNum = $(this).index();
                        $("p.score").text("評價中..." + (starNum + 1) + "顆星");
                    },
                    mouseleave: function (event) {
                        $(this).prop("class", "star").prevAll().prop("class", "star");
                        $("p.score").text("點擊填寫評價");
                    },
                    click: function () {
                        $("p.score").text("評價完成:" + (starNum + 1) + "顆星，雙擊2下重新評價");
                        $(this).off("mouseenter mouseleave click").siblings().off("mouseenter mouseleave click");
                        console.log(event.type);
                    }
                });
            }       
        });

        $(".f-w-400").click(function () {        
            var ModiTr1 = $(this).closest("tr");
            var CourseClassID = ModiTr1.children("td").eq(0).text().trim();
            $("#ScoreForm>input").eq(0).val(CourseClassID);
        });

        $(".ScoreAfterClass").click(function () {
            var Classcomment = $(".content").val();
            var ClassScore = (starNum + 1);
            $("#ScoreForm>input").eq(1).val(Classcomment);
            $("#ScoreForm>input").eq(2).val(ClassScore);
                const formData = new FormData(document.Score)
                fetch('@Url.Content("~/PersonalArea/ScoreUpdate")', {
                method: 'POST',
                body:formData
                }).then(async function (response) {
                    if (response.ok) {
                        alert("評分已送出");
                    }
                    else {
                        alert("評分未完成");
                    }
                })
        });

    $(function () {        
        $("#dialogClockIn").hide();
        $(".Demo").click(function () {
            $(".content").text("教練教學優質，讓人想一上在上");
        })
    });
        var initial = "listWeek";
        document.addEventListener('DOMContentLoaded', LoadCalendat);

        function LoadCalendat() {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: initial,
                locale: 'zh-tw',
                height: 470,
                slotMinTime: "08:00:00",
                slotMaxTime: "23:00:00",
                slotDuration: '01:00:00',
                slotLabelFormat: {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                },
                allDaySlot: false,
                /* navLinks: true,*/
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'timeGridWeek,timeGridDay,listWeek'
                },
                views: {
                    timeGrid: {
                        displayEventTime: false
                    }
                },
                dateClick: function (info) {
                    $("#dialogLesson").dialog({
                        height: 500,
                        width:400
                    });
                    var time = info.dateStr;
                    var a = time.indexOf("+");
                    $("#courseTime").val(time.substring(0, a));
                },
                
                eventBackgroundColor: '#FFA500',
                eventTextColor: '#000000',
                events: '@Url.Content("~/api/selectMemberClass")'
            });
           
            calendar.render();
        };        
    </script>
}

